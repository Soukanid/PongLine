
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:../data/user.db.sqlite" 
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  username  String   @unique
  avatar    Bytes
  isOnline  Boolean  @default(false)
  
  sentRequests     Friendship[] @relation("sender")
  receivedRequests Friendship[] @relation("receiver")

  blocksInitiated     Block[] @relation("blocker")
  blocksReceived      Block[] @relation("blocked")
}

model Friendship {
  id        Int      @id @default(autoincrement())

  //the status can be either  PENDING, ACCEPTED, BLOCKED 
  status    String   @default("PENDING")
  
  senderId  Int
  sender    User     @relation("sender", fields: [senderId], references: [id])
  
  receiverId Int
  receiver User     @relation("receiver", fields: [receiverId], references: [id])

  //It Prevent duplicate friend requests
  @@unique([senderId, receiverId]) 
}

model Block {
  id          Int       @id @default(autoincrement())

  blockerId   Int 
  blocker User  @relation("blocker", fields: [blockerId], references: [id])

  blockedId   Int 
  blocked User  @relation("blocked", fields: [blockedId], references: [id])

  @@unique([blockerId, blockedId]) 
}
